@using MarketZone.Data.Enums
@model MarketZone.ViewModels.Ad.AdDetailsModel

@{
    ViewData["Title"] = Model.Title;

    string sellerImage = ViewBag.SellerProfileImageUrl ?? "/images/default-profile.png";
    string sellerId = ViewBag.SellerId ?? "";
}

<h2>@Model.Title</h2>

<div class="text-muted mb-3">
    Posted on @Model.CreatedOn.ToString("dd MMM yyyy")
</div>

<div class="row">
    <!-- Images -->
    <div class="col-md-6">
        @if (Model.ImageUrls.Any())
        {
            <img id="main-image"
                 src="@Model.ImageUrls.First()"
                 class="img-fluid rounded mb-3" />

            <div class="d-flex gap-2 flex-wrap">
                @foreach (var img in Model.ImageUrls)
                {
                    <img src="@img"
                         class="img-thumbnail"
                         style="width:80px;height:80px;object-fit:cover;cursor:pointer"
                         onclick="document.getElementById('main-image').src='@img'" />
                }
            </div>
        }
        else
        {
            <div class="border p-5 text-center text-muted">
                No images
            </div>
        }
    </div>

    <!-- Details -->
    <div class="col-md-6">
        <h3 class="text-primary">
            @Model.Price
            @(Model.Currency == Currency.EUR ? "€" : "$")
        </h3>

        <span class="badge bg-secondary mb-3">
            @Model.Condition
        </span>

        <!-- Action buttons -->
        <div class="d-flex gap-2 mb-3">
            <a asp-controller="Messages"
               asp-action="Chat"
               asp-route-adId="@Model.Id"
               asp-route-userId="@sellerId"
               class="btn btn-outline-primary">
                💬 Message Seller
            </a>

            <button id="favorite-btn"
                    type="button"
                    class="btn btn-outline-danger">
                <span id="favorite-icon">🤍</span> Add to Favorites
            </button>
        </div>

        <!-- Description -->
        <p style="max-width: 450px; word-wrap: break-word; white-space: pre-line;">
            @Model.Description
        </p>

        <!-- Tags -->
        @if (Model.Tags.Any())
        {
            <div class="mb-3">
                @foreach (var tag in Model.Tags)
                {
                    <span class="badge bg-light text-dark me-1">
                        #@tag
                    </span>
                }
            </div>
        }

        <p>
            <strong>Category:</strong> @Model.CategoryPath
        </p>

        <p>
            <strong>Address:</strong> @Model.Address
        </p>

        <!-- Seller -->
        <p class="d-flex align-items-center gap-2">
            <strong>Seller:</strong>

            <a asp-controller="User"
               asp-action="Profile"
               asp-route-id="@sellerId"
               class="d-flex align-items-center gap-2 text-decoration-none">

                <img src="@sellerImage"
                     alt="Seller profile picture"
                     class="rounded-circle"
                     style="width:32px;height:32px;object-fit:cover;" />

                <span>@Model.SellerName</span>
            </a>
        </p>
    </div>
</div>

@section Scripts {
    <script>
        const favBtn = document.getElementById("favorite-btn");
        const favIcon = document.getElementById("favorite-icon");

        let isFavorite = false;

        favBtn.addEventListener("click", () => {
            isFavorite = !isFavorite;
            favIcon.textContent = isFavorite ? "❤️" : "🤍";
            // Backend toggle will be added later
        });
    </script>
}
